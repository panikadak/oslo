(function(){class t extends THREE.Loader{constructor(t){super(t)}load(t,e,r,a){const n=this,i=new THREE.FileLoader(n.manager);i.setPath(n.path),i.setResponseType("arraybuffer"),i.setRequestHeader(n.requestHeader),i.setWithCredentials(n.withCredentials),i.load(t,(function(r){try{e(n.parse(r))}catch(i){a?a(i):console.error(i),n.manager.itemError(t)}}),r,a)}parse(t){function e(t){var e,r=[],a=[],n=[],i=[],s=/^[^\d.\s-]+/,o=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,f=/^POINTS /,u=/^POLYGONS /,p=/^TRIANGLE_STRIPS /,A=/^POINT_DATA[ ]+(\d+)/,h=/^CELL_DATA[ ]+(\d+)/,d=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,c=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,y=!1,b=!1,w=!1,x=!1,v=!1,I=!1,E=!1,g=t.split("\n");for(var T in g){var m=g[T].trim();if(0===m.indexOf("DATASET")){var O=m.split(" ")[1];if("POLYDATA"!==O)throw new Error("Unsupported DATASET type: "+O)}else if(y)while(null!==(e=o.exec(m))){if(null!==s.exec(m))break;var D=parseFloat(e[1]),F=parseFloat(e[2]),R=parseFloat(e[3]);a.push(D,F,R)}else if(b){if(null!==(e=l.exec(m))){var P=parseInt(e[1]),S=e[2].split(/\s+/);if(P>=3)for(var C=parseInt(S[0]),N=1,H=0;H<P-2;++H)L=parseInt(S[N]),U=parseInt(S[N+1]),r.push(C,L,U),N++}}else if(w){if(null!==(e=l.exec(m))){P=parseInt(e[1]),S=e[2].split(/\s+/);if(P>=3){var L,U;for(H=0;H<P-2;H++)H%2===1?(C=parseInt(S[H]),L=parseInt(S[H+2]),U=parseInt(S[H+1]),r.push(C,L,U)):(C=parseInt(S[H]),L=parseInt(S[H+1]),U=parseInt(S[H+2]),r.push(C,L,U))}}}else if(x||v)if(I)while(null!==(e=o.exec(m))){if(null!==s.exec(m))break;var B=parseFloat(e[1]),k=parseFloat(e[2]),_=parseFloat(e[3]);n.push(B,k,_)}else if(E)while(null!==(e=o.exec(m))){if(null!==s.exec(m))break;var G=parseFloat(e[1]),M=parseFloat(e[2]),j=parseFloat(e[3]);i.push(G,M,j)}null!==u.exec(m)?(b=!0,y=!1,w=!1):null!==f.exec(m)?(b=!1,y=!0,w=!1):null!==p.exec(m)?(b=!1,y=!1,w=!0):null!==A.exec(m)?(x=!0,y=!1,b=!1,w=!1):null!==h.exec(m)?(v=!0,y=!1,b=!1,w=!1):null!==d.exec(m)?(I=!0,E=!1,y=!1,b=!1,w=!1):null!==c.exec(m)&&(E=!0,I=!1,y=!1,b=!1,w=!1)}var V=new THREE.BufferGeometry;if(V.setIndex(r),V.setAttribute("position",new THREE.Float32BufferAttribute(a,3)),i.length===a.length&&V.setAttribute("normal",new THREE.Float32BufferAttribute(i,3)),n.length!==r.length)n.length===a.length&&V.setAttribute("color",new THREE.Float32BufferAttribute(n,3));else{V=V.toNonIndexed();var X=V.attributes.position.count/3;if(n.length===3*X){var Y=[];for(T=0;T<X;T++){B=n[3*T+0],k=n[3*T+1],_=n[3*T+2];Y.push(B,k,_),Y.push(B,k,_),Y.push(B,k,_)}V.setAttribute("color",new THREE.Float32BufferAttribute(Y,3))}}return V}function r(t){var e,r,a,n,i,s,o,l=new Uint8Array(t),f=new DataView(t),u=[],p=[],A=[],h=[],d=0;function c(t,e){var r=e,a=t[r],n=[];while(10!==a)n.push(String.fromCharCode(a)),r++,a=t[r];return{start:e,end:r,next:r+1,parsedString:n.join("")}}while(1){if(s=c(l,d),o=s.parsedString,0===o.indexOf("DATASET")){var y=o.split(" ")[1];if("POLYDATA"!==y)throw new Error("Unsupported DATASET type: "+y)}else if(0===o.indexOf("POINTS")){for(h.push(o),n=parseInt(o.split(" ")[1],10),e=4*n*3,u=new Float32Array(3*n),r=s.next,a=0;a<n;a++)u[3*a]=f.getFloat32(r,!1),u[3*a+1]=f.getFloat32(r+4,!1),u[3*a+2]=f.getFloat32(r+8,!1),r+=12;s.next=s.next+e+1}else if(0===o.indexOf("TRIANGLE_STRIPS")){var b=parseInt(o.split(" ")[1],10),w=parseInt(o.split(" ")[2],10);e=4*w,A=new Uint32Array(3*w-9*b);var x=0;for(r=s.next,a=0;a<b;a++){var v=f.getInt32(r,!1),I=[];for(r+=4,i=0;i<v;i++)I.push(f.getInt32(r,!1)),r+=4;for(var E=0;E<v-2;E++)E%2?(A[x++]=I[E],A[x++]=I[E+2],A[x++]=I[E+1]):(A[x++]=I[E],A[x++]=I[E+1],A[x++]=I[E+2])}s.next=s.next+e+1}else if(0===o.indexOf("POLYGONS")){b=parseInt(o.split(" ")[1],10),w=parseInt(o.split(" ")[2],10);e=4*w,A=new Uint32Array(3*w-9*b);x=0;for(r=s.next,a=0;a<b;a++){v=f.getInt32(r,!1),I=[];for(r+=4,i=0;i<v;i++)I.push(f.getInt32(r,!1)),r+=4;for(E=1;E<v-1;E++)A[x++]=I[0],A[x++]=I[E],A[x++]=I[E+1]}s.next=s.next+e+1}else if(0===o.indexOf("POINT_DATA")){for(n=parseInt(o.split(" ")[1],10),s=c(l,s.next),e=4*n*3,p=new Float32Array(3*n),r=s.next,a=0;a<n;a++)p[3*a]=f.getFloat32(r,!1),p[3*a+1]=f.getFloat32(r+4,!1),p[3*a+2]=f.getFloat32(r+8,!1),r+=12;s.next=s.next+e}if(d=s.next,d>=l.byteLength)break}var g=new THREE.BufferGeometry;return g.setIndex(new THREE.BufferAttribute(A,1)),g.setAttribute("position",new THREE.BufferAttribute(u,3)),p.length===u.length&&g.setAttribute("normal",new THREE.BufferAttribute(p,3)),g}function a(t,e){const r=t.length,a=new Float32Array(r+e.length);return a.set(t),a.set(e,r),a}function n(t,e){var r=t.length,a=new Int32Array(r+e.length);return a.set(t),a.set(e,r),a}function i(t){function e(t){var r={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){r["attributes"]={};for(var a=0;a<t.attributes.length;a++){var n=t.attributes.item(a);r["attributes"][n.nodeName]=n.nodeValue.trim()}}}else 3===t.nodeType&&(r=t.nodeValue.trim());if(t.hasChildNodes())for(var i=0;i<t.childNodes.length;i++){var s=t.childNodes.item(i),o=s.nodeName;if("undefined"===typeof r[o]){var l=e(s);""!==l&&(r[o]=l)}else{if("undefined"===typeof r[o].push){var f=r[o];r[o]=[f]}l=e(s);""!==l&&r[o].push(l)}}return r}function r(t){var e,r,a,n,i,s,o="undefined"!==typeof Uint8Array?Uint8Array:Array,l=[],f=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=u.length;for(e=0;e<p;e++)l[e]=u[e];for(e=0;e<p;++e)f[u.charCodeAt(e)]=e;f["-".charCodeAt(0)]=62,f["_".charCodeAt(0)]=63;p=t.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i="="===t[p-2]?2:"="===t[p-1]?1:0,s=new o(3*p/4-i),a=i>0?p-4:p;var A=0;for(e=0,r=0;e<a;e+=4,r+=3)n=f[t.charCodeAt(e)]<<18|f[t.charCodeAt(e+1)]<<12|f[t.charCodeAt(e+2)]<<6|f[t.charCodeAt(e+3)],s[A++]=(16711680&n)>>16,s[A++]=(65280&n)>>8,s[A++]=255&n;return 2===i?(n=f[t.charCodeAt(e)]<<2|f[t.charCodeAt(e+1)]>>4,s[A++]=255&n):1===i&&(n=f[t.charCodeAt(e)]<<10|f[t.charCodeAt(e+1)]<<4|f[t.charCodeAt(e+2)]>>2,s[A++]=n>>8&255,s[A++]=255&n),s}function i(t,e){var i=0;if("UInt64"===l.attributes.header_type?i=8:"UInt32"===l.attributes.header_type&&(i=4),"binary"===t.attributes.format&&e){var s,o,f,u,p,A,h,d;if("Float32"===t.attributes.type)var c=new Float32Array;else if("Int64"===t.attributes.type)c=new Int32Array;s=t["#text"],o=r(s),f=o[0];for(var y=1;y<i-1;y++)f|=o[y]<<y*i;p=(f+3)*i,A=p%3>0?3-p%3:0,p+=A,h=[],d=p,h.push(d),u=3*i;for(y=0;y<f;y++){for(var b=o[y*i+u],w=1;w<i-1;w++)b|=o[y*i+u+w]<<8*w;d+=b,h.push(d)}for(y=0;y<h.length-1;y++){var x=fflate.unzlibSync(o.slice(h[y],h[y+1]));v=x.buffer,"Float32"===t.attributes.type?(v=new Float32Array(v),c=a(c,v)):"Int64"===t.attributes.type&&(v=new Int32Array(v),c=n(c,v))}delete t["#text"],"Int64"===t.attributes.type&&"binary"===t.attributes.format&&(c=c.filter((function(t,e){if(e%2!==1)return!0})))}else{if("binary"!==t.attributes.format||e)if(t["#text"])v=t["#text"].split(/\s+/).filter((function(t){if(""!==t)return t}));else v=new Int32Array(0).buffer;else{var v=r(t["#text"]);v=v.slice(i).buffer}if(delete t["#text"],"Float32"===t.attributes.type)c=new Float32Array(v);else if("Int32"===t.attributes.type)c=new Int32Array(v);else if("Int64"===t.attributes.type){c=new Int32Array(v);"binary"===t.attributes.format&&(c=c.filter((function(t,e){if(e%2!==1)return!0})))}}return c}var s=null;if(window.DOMParser)try{s=(new DOMParser).parseFromString(t,"text/xml")}catch(G){s=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if(s=new ActiveXObject("Microsoft.XMLDOM"),s.async=!1,!s.loadXML())throw new Error(s.parseError.reason+s.parseError.srcText)}catch(G){s=null}}var o=s.documentElement,l=e(o),f=[],u=[],p=[];if(l.PolyData){var A=l.PolyData.Piece,h=l.attributes.hasOwnProperty("compressor"),d=["PointData","Points","Strips","Polys"],c=0,y=d.length;while(c<y){var b=A[d[c]];if(b&&b.DataArray){if("[object Array]"===Object.prototype.toString.call(b.DataArray))var w=b.DataArray;else w=[b.DataArray];var x=0,v=w.length;while(x<v)"#text"in w[x]&&w[x]["#text"].length>0&&(w[x].text=i(w[x],h)),x++;switch(d[c]){case"PointData":var I=parseInt(A.attributes.NumberOfPoints),E=b.attributes.Normals;if(I>0)for(var g=0,T=w.length;g<T;g++)if(E===w[g].attributes.Name){var m=w[g].attributes.NumberOfComponents;u=new Float32Array(I*m),u.set(w[g].text,0)}break;case"Points":I=parseInt(A.attributes.NumberOfPoints);if(I>0){m=b.DataArray.attributes.NumberOfComponents;f=new Float32Array(I*m),f.set(b.DataArray.text,0)}break;case"Strips":var O=parseInt(A.attributes.NumberOfStrips);if(O>0){var D=new Int32Array(b.DataArray[0].text.length),F=new Int32Array(b.DataArray[1].text.length);D.set(b.DataArray[0].text,0),F.set(b.DataArray[1].text,0);var R=O+D.length;p=new Uint32Array(3*R-9*O);var P=0;for(g=0,T=O;g<T;g++){for(var S=[],C=0,N=F[g],H=0;C<N-H;C++)S.push(D[C]),g>0&&(H=F[g-1]);var L=0;for(N=F[g],H=0;L<N-H-2;L++)L%2?(p[P++]=S[L],p[P++]=S[L+2],p[P++]=S[L+1]):(p[P++]=S[L],p[P++]=S[L+1],p[P++]=S[L+2]),g>0&&(H=F[g-1])}}break;case"Polys":var U=parseInt(A.attributes.NumberOfPolys);if(U>0){D=new Int32Array(b.DataArray[0].text.length),F=new Int32Array(b.DataArray[1].text.length);D.set(b.DataArray[0].text,0),F.set(b.DataArray[1].text,0);R=U+D.length;p=new Uint32Array(3*R-9*U);P=0;var B=0;g=0,T=U,H=0;while(g<T){var k=[];C=0,N=F[g];while(C<N-H)k.push(D[B++]),C++;L=1;while(L<N-H-1)p[P++]=k[0],p[P++]=k[L],p[P++]=k[L+1],L++;g++,H=F[g-1]}}break;default:break}}c++}var _=new THREE.BufferGeometry;return _.setIndex(new THREE.BufferAttribute(p,1)),_.setAttribute("position",new THREE.BufferAttribute(f,3)),u.length===f.length&&_.setAttribute("normal",new THREE.BufferAttribute(u,3)),_}throw new Error("Unsupported DATASET type")}var s=THREE.LoaderUtils.decodeText(new Uint8Array(t,0,250)).split("\n");return-1!==s[0].indexOf("xml")?i(THREE.LoaderUtils.decodeText(t)):s[2].includes("ASCII")?e(THREE.LoaderUtils.decodeText(t)):r(t)}}THREE.VTKLoader=t})();