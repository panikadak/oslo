(function(){class e extends THREE.DataTextureLoader{constructor(e){super(e),this.type=THREE.HalfFloatType}parse(e){const r=65536,n=r>>3,t=16,a=14,i=1+(1<<t),o=1<<a,l=o-1,s=16,u=1<<s-1,c=(1<<s)-1,f=59,v=63,h=2+v-f,w=8,p=4,d=4,y=2,E=1,S=0,b=1,g=0,m=1,A=2,R=Math.pow(2.7182818,2.2);function U(e,n){for(var t=0,a=0;a<r;++a)(0==a||e[a>>3]&1<<(7&a))&&(n[t++]=a);var i=t-1;while(t<r)n[t++]=0;return i}function M(e){for(var r=0;r<o;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const z={l:0,c:0,lc:0};function C(e,r,n,t,a){while(n<e)r=r<<8|de(t,a),n+=8;n-=e,z.l=r>>n&(1<<e)-1,z.c=r,z.lc=n}const O=new Array(59);function T(e){for(var r=0;r<=58;++r)O[r]=0;for(r=0;r<i;++r)O[e[r]]+=1;var n=0;for(r=58;r>0;--r){var t=n+O[r]>>1;O[r]=n,n=t}for(r=0;r<i;++r){var a=e[r];a>0&&(e[r]=a|O[a]++<<6)}}function k(e,r,n,t,a,i,o){for(var l=n,s=0,u=0;a<=i;a++){if(l.value-n.value>t)return!1;C(6,s,u,e,l);var c=z.l;if(s=z.c,u=z.lc,o[a]=c,c==v){if(l.value-n.value>t)throw"Something wrong with hufUnpackEncTable";C(8,s,u,e,l);var w=z.l+h;if(s=z.c,u=z.lc,a+w>i+1)throw"Something wrong with hufUnpackEncTable";while(w--)o[a++]=0;a--}else if(c>=f){w=c-f+2;if(a+w>i+1)throw"Something wrong with hufUnpackEncTable";while(w--)o[a++]=0;a--}}T(o)}function I(e){return 63&e}function x(e){return e>>6}function P(e,r,n,t){for(;r<=n;r++){var i=x(e[r]),o=I(e[r]);if(i>>o)throw"Invalid table entry";if(o>a){var l=t[i>>o-a];if(l.len)throw"Invalid table entry";if(l.lit++,l.p){var s=l.p;l.p=new Array(l.lit);for(var u=0;u<l.lit-1;++u)l.p[u]=s[u]}else l.p=new Array(1);l.p[l.lit-1]=r}else if(o){var c=0;for(u=1<<a-o;u>0;u--){l=t[(i<<a-o)+c];if(l.len||l.p)throw"Invalid table entry";l.len=o,l.lit=r,c++}}}return!0}const H={c:0,lc:0};function N(e,r,n,t){e=e<<8|de(n,t),r+=8,H.c=e,H.lc=r}const L={c:0,lc:0};function D(e,r,n,t,a,i,o,l,s,u){if(e==r){t<8&&(N(n,t,a,o),n=H.c,t=H.lc),t-=8;var c=n>>t;c=new Uint8Array([c])[0];if(s.value+c>u)return!1;var f=l[s.value-1];while(c-- >0)l[s.value++]=f}else{if(!(s.value<u))return!1;l[s.value++]=e}L.c=n,L.lc=t}function _(e){return 65535&e}function F(e){var r=_(e);return r>32767?r-65536:r}const X={a:0,b:0};function B(e,r){var n=F(e),t=F(r),a=t,i=n+(1&a)+(a>>1),o=i,l=i-a;X.a=o,X.b=l}function V(e,r){var n=_(e),t=_(r),a=n-(t>>1)&c,i=t+a-u&c;X.a=i,X.b=a}function W(e,r,n,t,a,i,o){var l,s=o<16384,u=n>a?a:n,c=1;while(c<=u)c<<=1;c>>=1,l=c,c>>=1;while(c>=1){for(var f,v,h,w,p=0,d=p+i*(a-l),y=i*c,E=i*l,S=t*c,b=t*l;p<=d;p+=E){for(var g=p,m=p+t*(n-l);g<=m;g+=b){var A=g+S,R=g+y,U=R+S;s?(B(e[g+r],e[R+r]),f=X.a,h=X.b,B(e[A+r],e[U+r]),v=X.a,w=X.b,B(f,v),e[g+r]=X.a,e[A+r]=X.b,B(h,w),e[R+r]=X.a,e[U+r]=X.b):(V(e[g+r],e[R+r]),f=X.a,h=X.b,V(e[A+r],e[U+r]),v=X.a,w=X.b,V(f,v),e[g+r]=X.a,e[A+r]=X.b,V(h,w),e[R+r]=X.a,e[U+r]=X.b)}if(n&c){R=g+y;s?B(e[g+r],e[R+r]):V(e[g+r],e[R+r]),f=X.a,e[R+r]=X.b,e[g+r]=f}}if(a&c)for(g=p,m=p+t*(n-l);g<=m;g+=b){A=g+S;s?B(e[g+r],e[A+r]):V(e[g+r],e[A+r]),f=X.a,e[A+r]=X.b,e[g+r]=f}l=c,c>>=1}return p}function Z(e,r,n,t,i,o,s,u,c,f){var v=0,h=0,w=u,p=Math.trunc(i.value+(o+7)/8);while(i.value<p){N(v,h,n,i),v=H.c,h=H.lc;while(h>=a){var d=v>>h-a&l,y=r[d];if(y.len)h-=y.len,D(y.lit,s,v,h,n,t,i,c,f,w),v=L.c,h=L.lc;else{if(!y.p)throw"hufDecode issues";var E;for(E=0;E<y.lit;E++){var S=I(e[y.p[E]]);while(h<S&&i.value<p)N(v,h,n,i),v=H.c,h=H.lc;if(h>=S&&x(e[y.p[E]])==(v>>h-S&(1<<S)-1)){h-=S,D(y.p[E],s,v,h,n,t,i,c,f,w),v=L.c,h=L.lc;break}}if(E==y.lit)throw"hufDecode issues"}}}var b=8-o&7;v>>=b,h-=b;while(h>0){y=r[v<<a-h&l];if(!y.len)throw"hufDecode issues";h-=y.len,D(y.lit,s,v,h,n,t,i,c,f,w),v=L.c,h=L.lc}return!0}function Y(e,r,n,t,a,l){var s={value:0},u=n.value,c=pe(r,n),f=pe(r,n);n.value+=4;var v=pe(r,n);if(n.value+=4,c<0||c>=i||f<0||f>=i)throw"Something wrong with HUF_ENCSIZE";var h=new Array(i),w=new Array(o);M(w);var p=t-(n.value-u);if(k(e,r,n,p,c,f,h),v>8*(t-(n.value-u)))throw"Something wrong with hufUncompress";P(h,c,f,w),Z(h,w,e,r,n,v,f,l,a,s)}function G(e,r,n){for(var t=0;t<n;++t)r[t]=e[r[t]]}function j(e){for(var r=1;r<e.length;r++){var n=e[r-1]+e[r]-128;e[r]=n}}function q(e,r){var n=0,t=Math.floor((e.length+1)/2),a=0,i=e.length-1;while(1){if(a>i)break;if(r[a++]=e[n++],a>i)break;r[a++]=e[t++]}}function $(e){var r=e.byteLength,n=new Array,t=0,a=new DataView(e);while(r>0){var i=a.getInt8(t++);if(i<0){var o=-i;r-=o+1;for(var l=0;l<o;l++)n.push(a.getUint8(t++))}else{o=i;r-=2;var s=a.getUint8(t++);for(l=0;l<o+1;l++)n.push(s)}}return n}function J(e,r,n,t,a,i){var o=new DataView(i.buffer),l=n[e.idx[0]].width,s=n[e.idx[0]].height,u=3,c=Math.floor(l/8),f=Math.ceil(l/8),v=Math.ceil(s/8),h=l-8*(f-1),w=s-8*(v-1),p={value:0},d=new Array(u),E=new Array(u),S=new Array(u),b=new Array(u),g=new Array(u);for(let y=0;y<u;++y)g[y]=r[e.idx[y]],d[y]=y<1?0:d[y-1]+f*v,E[y]=new Float32Array(64),S[y]=new Uint16Array(64),b[y]=new Uint16Array(64*f);for(let O=0;O<v;++O){var m=8;O==v-1&&(m=w);var A=8;for(let e=0;e<f;++e){e==f-1&&(A=h);for(let e=0;e<u;++e)S[e].fill(0),S[e][0]=a[d[e]++],K(p,t,S[e]),Q(S[e],E[e]),ee(E[e]);3==u&&re(E);for(let r=0;r<u;++r)ne(E[r],b[r],64*e)}let r=0;for(let t=0;t<u;++t){const a=n[e.idx[t]].type;for(let e=8*O;e<8*O+m;++e){r=g[t][e];for(let n=0;n<c;++n){const i=64*n+8*(7&e);o.setUint16(r+0*y*a,b[t][i+0],!0),o.setUint16(r+1*y*a,b[t][i+1],!0),o.setUint16(r+2*y*a,b[t][i+2],!0),o.setUint16(r+3*y*a,b[t][i+3],!0),o.setUint16(r+4*y*a,b[t][i+4],!0),o.setUint16(r+5*y*a,b[t][i+5],!0),o.setUint16(r+6*y*a,b[t][i+6],!0),o.setUint16(r+7*y*a,b[t][i+7],!0),r+=8*y*a}}if(c!=f)for(let e=8*O;e<8*O+m;++e){const r=g[t][e]+8*c*y*a,n=64*c+8*(7&e);for(let e=0;e<A;++e)o.setUint16(r+e*y*a,b[t][n+e],!0)}}}for(var R=new Uint16Array(l),U=(o=new DataView(i.buffer),0);U<u;++U){n[e.idx[U]].decoded=!0;var M=n[e.idx[U]].type;if(2==n[U].type)for(var z=0;z<s;++z){const e=g[U][z];for(var C=0;C<l;++C)R[C]=o.getUint16(e+C*y*M,!0);for(C=0;C<l;++C)o.setFloat32(e+C*y*M,ge(R[C]),!0)}}}function K(e,r,n){var t,a=1;while(a<64)t=r[e.value],65280==t?a=64:t>>8==255?a+=255&t:(n[a]=t,a++),e.value++}function Q(e,r){r[0]=ge(e[0]),r[1]=ge(e[1]),r[2]=ge(e[5]),r[3]=ge(e[6]),r[4]=ge(e[14]),r[5]=ge(e[15]),r[6]=ge(e[27]),r[7]=ge(e[28]),r[8]=ge(e[2]),r[9]=ge(e[4]),r[10]=ge(e[7]),r[11]=ge(e[13]),r[12]=ge(e[16]),r[13]=ge(e[26]),r[14]=ge(e[29]),r[15]=ge(e[42]),r[16]=ge(e[3]),r[17]=ge(e[8]),r[18]=ge(e[12]),r[19]=ge(e[17]),r[20]=ge(e[25]),r[21]=ge(e[30]),r[22]=ge(e[41]),r[23]=ge(e[43]),r[24]=ge(e[9]),r[25]=ge(e[11]),r[26]=ge(e[18]),r[27]=ge(e[24]),r[28]=ge(e[31]),r[29]=ge(e[40]),r[30]=ge(e[44]),r[31]=ge(e[53]),r[32]=ge(e[10]),r[33]=ge(e[19]),r[34]=ge(e[23]),r[35]=ge(e[32]),r[36]=ge(e[39]),r[37]=ge(e[45]),r[38]=ge(e[52]),r[39]=ge(e[54]),r[40]=ge(e[20]),r[41]=ge(e[22]),r[42]=ge(e[33]),r[43]=ge(e[38]),r[44]=ge(e[46]),r[45]=ge(e[51]),r[46]=ge(e[55]),r[47]=ge(e[60]),r[48]=ge(e[21]),r[49]=ge(e[34]),r[50]=ge(e[37]),r[51]=ge(e[47]),r[52]=ge(e[50]),r[53]=ge(e[56]),r[54]=ge(e[59]),r[55]=ge(e[61]),r[56]=ge(e[35]),r[57]=ge(e[36]),r[58]=ge(e[48]),r[59]=ge(e[49]),r[60]=ge(e[57]),r[61]=ge(e[58]),r[62]=ge(e[62]),r[63]=ge(e[63])}function ee(e){const r=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),t=.5*Math.cos(3.14159/8),a=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),l=.5*Math.cos(1.374445625);for(var s=new Array(4),u=new Array(4),c=new Array(4),f=new Array(4),v=0;v<8;++v){var h=8*v;s[0]=t*e[h+2],s[1]=o*e[h+2],s[2]=t*e[h+6],s[3]=o*e[h+6],u[0]=n*e[h+1]+a*e[h+3]+i*e[h+5]+l*e[h+7],u[1]=a*e[h+1]-l*e[h+3]-n*e[h+5]-i*e[h+7],u[2]=i*e[h+1]-n*e[h+3]+l*e[h+5]+a*e[h+7],u[3]=l*e[h+1]-i*e[h+3]+a*e[h+5]-n*e[h+7],c[0]=r*(e[h+0]+e[h+4]),c[3]=r*(e[h+0]-e[h+4]),c[1]=s[0]+s[3],c[2]=s[1]-s[2],f[0]=c[0]+c[1],f[1]=c[3]+c[2],f[2]=c[3]-c[2],f[3]=c[0]-c[1],e[h+0]=f[0]+u[0],e[h+1]=f[1]+u[1],e[h+2]=f[2]+u[2],e[h+3]=f[3]+u[3],e[h+4]=f[3]-u[3],e[h+5]=f[2]-u[2],e[h+6]=f[1]-u[1],e[h+7]=f[0]-u[0]}for(var w=0;w<8;++w)s[0]=t*e[16+w],s[1]=o*e[16+w],s[2]=t*e[48+w],s[3]=o*e[48+w],u[0]=n*e[8+w]+a*e[24+w]+i*e[40+w]+l*e[56+w],u[1]=a*e[8+w]-l*e[24+w]-n*e[40+w]-i*e[56+w],u[2]=i*e[8+w]-n*e[24+w]+l*e[40+w]+a*e[56+w],u[3]=l*e[8+w]-i*e[24+w]+a*e[40+w]-n*e[56+w],c[0]=r*(e[w]+e[32+w]),c[3]=r*(e[w]-e[32+w]),c[1]=s[0]+s[3],c[2]=s[1]-s[2],f[0]=c[0]+c[1],f[1]=c[3]+c[2],f[2]=c[3]-c[2],f[3]=c[0]-c[1],e[0+w]=f[0]+u[0],e[8+w]=f[1]+u[1],e[16+w]=f[2]+u[2],e[24+w]=f[3]+u[3],e[32+w]=f[3]-u[3],e[40+w]=f[2]-u[2],e[48+w]=f[1]-u[1],e[56+w]=f[0]-u[0]}function re(e){for(var r=0;r<64;++r){var n=e[0][r],t=e[1][r],a=e[2][r];e[0][r]=n+1.5747*a,e[1][r]=n-.1873*t-.4682*a,e[2][r]=n+1.8556*t}}function ne(e,r,n){for(var t=0;t<64;++t)r[n+t]=THREE.DataUtils.toHalfFloat(te(e[t]))}function te(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(R,Math.abs(e)-1)}function ae(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function ie(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array($(r)),t=new Uint8Array(n.length);return j(n),q(n,t),new DataView(t.buffer)}function oe(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size);"undefined"===typeof fflate&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var n=fflate.unzlibSync(r),t=new Uint8Array(n.length);return j(n),q(n,t),new DataView(t.buffer)}function le(e){for(var t=e.viewer,a={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),o=new Uint8Array(n),l=0,s=new Array(e.channels),u=0;u<e.channels;u++)s[u]={},s[u]["start"]=l,s[u]["end"]=s[u]["start"],s[u]["nx"]=e.width,s[u]["ny"]=e.lines,s[u]["size"]=e.type,l+=s[u].nx*s[u].ny*s[u].size;var c=me(t,a),f=me(t,a);if(f>=n)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=f)for(u=0;u<f-c+1;u++)o[u+c]=ye(t,a);var v=new Uint16Array(r),h=U(o,v),w=pe(t,a);Y(e.array,t,a,w,i,l);for(u=0;u<e.channels;++u)for(var p=s[u],d=0;d<s[u].size;++d)W(i,p.start+d,p.nx,p.size,p.ny,p.nx*p.size,h);G(v,i,l);for(var E=0,S=new Uint8Array(i.buffer.byteLength),b=0;b<e.lines;b++)for(var g=0;g<e.channels;g++){p=s[g];var m=p.nx*p.size,A=new Uint8Array(i.buffer,p.end*y,m*y);S.set(A,E),E+=m*y,p.end+=m}return new DataView(S.buffer)}function se(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size);"undefined"===typeof fflate&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var n=fflate.unzlibSync(r);const t=e.lines*e.channels*e.width,a=1==e.type?new Uint16Array(t):new Uint32Array(t);let i=0,o=0;const l=new Array(4);for(let s=0;s<e.lines;s++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:l[0]=i,l[1]=l[0]+e.width,i=l[1]+e.width;for(let t=0;t<e.width;++t){const e=n[l[0]++]<<8|n[l[1]++];r+=e,a[o]=r,o++}break;case 2:l[0]=i,l[1]=l[0]+e.width,l[2]=l[1]+e.width,i=l[2]+e.width;for(let t=0;t<e.width;++t){const e=n[l[0]++]<<24|n[l[1]++]<<16|n[l[2]++]<<8;r+=e,a[o]=r,o++}break}}return new DataView(a.buffer)}function ue(e){var r=e.viewer,n={value:e.offset.value},t=new Uint8Array(e.width*e.lines*(e.channels*e.type*y)),a={version:Ee(r,n),unknownUncompressedSize:Ee(r,n),unknownCompressedSize:Ee(r,n),acCompressedSize:Ee(r,n),dcCompressedSize:Ee(r,n),rleCompressedSize:Ee(r,n),rleUncompressedSize:Ee(r,n),rleRawSize:Ee(r,n),totalAcUncompressedCount:Ee(r,n),totalDcUncompressedCount:Ee(r,n),acCompression:Ee(r,n)};if(a.version<2)throw"EXRLoader.parse: "+Le.compression+" version "+a.version+" is unsupported";var i=new Array,o=me(r,n)-y;while(o>0){var l=ce(r.buffer,n),s=ye(r,n),u=s>>2&3,c=(s>>4)-1,f=new Int8Array([c])[0],v=ye(r,n);i.push({name:l,index:f,type:v,compression:u}),o-=l.length+3}for(var h=Le.channels,w=new Array(e.channels),p=0;p<e.channels;++p){var d=w[p]={},E=h[p];d.name=E.name,d.compression=g,d.decoded=!1,d.type=E.pixelType,d.pLinear=E.pLinear,d.width=e.width,d.height=e.lines}for(var R={idx:new Array(3)},U=0;U<e.channels;++U)for(d=w[U],p=0;p<i.length;++p){var M=i[p];d.name==M.name&&(d.compression=M.compression,M.index>=0&&(R.idx[M.index]=U),d.offset=U)}if(a.acCompressedSize>0)switch(a.acCompression){case S:var z=new Uint16Array(a.totalAcUncompressedCount);Y(e.array,r,n,a.acCompressedSize,z,a.totalAcUncompressedCount);break;case b:var C=e.array.slice(n.value,n.value+a.totalAcUncompressedCount),O=fflate.unzlibSync(C);z=new Uint16Array(O.buffer);n.value+=a.totalAcUncompressedCount;break}if(a.dcCompressedSize>0){var T={array:e.array,offset:n,size:a.dcCompressedSize},k=new Uint16Array(oe(T).buffer);n.value+=a.dcCompressedSize}if(a.rleRawSize>0){C=e.array.slice(n.value,n.value+a.rleCompressedSize),O=fflate.unzlibSync(C);var I=$(O.buffer);n.value+=a.rleCompressedSize}var x=0,P=new Array(w.length);for(p=0;p<P.length;++p)P[p]=new Array;for(var H=0;H<e.lines;++H)for(var N=0;N<w.length;++N)P[N].push(x),x+=w[N].width*e.type*y;J(R,P,w,z,k,t);for(p=0;p<w.length;++p){d=w[p];if(!d.decoded)switch(d.compression){case A:var L=0,D=0;for(H=0;H<e.lines;++H){for(var _=P[p][L],F=0;F<d.width;++F){for(var X=0;X<y*d.type;++X)t[_++]=I[D+X*d.width*d.height];D++}L++}break;case m:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(t.buffer)}function ce(e,r){var n=new Uint8Array(e),t=0;while(0!=n[r.value+t])t+=1;var a=(new TextDecoder).decode(n.slice(r.value,r.value+t));return r.value=r.value+t+1,a}function fe(e,r,n){var t=(new TextDecoder).decode(new Uint8Array(e).slice(r.value,r.value+n));return r.value=r.value+n,t}function ve(e,r){var n=we(e,r),t=pe(e,r);return[n,t]}function he(e,r){var n=pe(e,r),t=pe(e,r);return[n,t]}function we(e,r){var n=e.getInt32(r.value,!0);return r.value=r.value+d,n}function pe(e,r){var n=e.getUint32(r.value,!0);return r.value=r.value+d,n}function de(e,r){var n=e[r.value];return r.value=r.value+E,n}function ye(e,r){var n=e.getUint8(r.value);return r.value=r.value+E,n}function Ee(e,r){var n=Number(e.getBigInt64(r.value,!0));return r.value+=w,n}function Se(e,r){var n=e.getFloat32(r.value,!0);return r.value+=p,n}function be(e,r){return THREE.DataUtils.toHalfFloat(Se(e,r))}function ge(e){var r=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(r?31===r?n?NaN:1/0:Math.pow(2,r-15)*(1+n/1024):n/1024*6103515625e-14)}function me(e,r){var n=e.getUint16(r.value,!0);return r.value+=y,n}function Ae(e,r){return ge(me(e,r))}function Re(e,r,n,t){var a=n.value,i=[];while(n.value<a+t-1){var o=ce(r,n),l=we(e,n),s=ye(e,n);n.value+=3;var u=we(e,n),c=we(e,n);i.push({name:o,pixelType:l,pLinear:s,xSampling:u,ySampling:c})}return n.value+=1,i}function Ue(e,r){var n=Se(e,r),t=Se(e,r),a=Se(e,r),i=Se(e,r),o=Se(e,r),l=Se(e,r),s=Se(e,r),u=Se(e,r);return{redX:n,redY:t,greenX:a,greenY:i,blueX:o,blueY:l,whiteX:s,whiteY:u}}function Me(e,r){var n=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],t=ye(e,r);return n[t]}function ze(e,r){var n=pe(e,r),t=pe(e,r),a=pe(e,r),i=pe(e,r);return{xMin:n,yMin:t,xMax:a,yMax:i}}function Ce(e,r){var n=["INCREASING_Y"],t=ye(e,r);return n[t]}function Oe(e,r){var n=Se(e,r),t=Se(e,r);return[n,t]}function Te(e,r){var n=Se(e,r),t=Se(e,r),a=Se(e,r);return[n,t,a]}function ke(e,r,n,t,a){return"string"===t||"stringvector"===t||"iccProfile"===t?fe(r,n,a):"chlist"===t?Re(e,r,n,a):"chromaticities"===t?Ue(e,n):"compression"===t?Me(e,n):"box2i"===t?ze(e,n):"lineOrder"===t?Ce(e,n):"float"===t?Se(e,n):"v2f"===t?Oe(e,n):"v3f"===t?Te(e,n):"int"===t?we(e,n):"rational"===t?ve(e,n):"timecode"===t?he(e,n):"preview"===t?(n.value+=a,"skipped"):void(n.value+=a)}function Ie(e,r,n){const t={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";t.version=e.getUint8(4,!0);const a=e.getUint8(5,!0);t.spec={singleTile:!!(1&a),longName:!!(2&a),deepFormat:!!(4&a),multiPart:!!(8&a)},n.value=8;var i=!0;while(i){var o=ce(r,n);if(0==o)i=!1;else{var l=ce(r,n),s=pe(e,n),u=ke(e,r,n,l,s);void 0===u?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${l}'.`):t[o]=u}}if(0!=a)throw console.error("EXRHeader:",t),"THREE.EXRLoader: provided file is currently unsupported.";return t}function xe(e,r,n,t,a){const i={size:0,viewer:r,array:n,offset:t,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(e.compression){case"NO_COMPRESSION":i.lines=1,i.uncompress=ae;break;case"RLE_COMPRESSION":i.lines=1,i.uncompress=ie;break;case"ZIPS_COMPRESSION":i.lines=1,i.uncompress=oe;break;case"ZIP_COMPRESSION":i.lines=16,i.uncompress=oe;break;case"PIZ_COMPRESSION":i.lines=32,i.uncompress=le;break;case"PXR24_COMPRESSION":i.lines=16,i.uncompress=se;break;case"DWAA_COMPRESSION":i.lines=32,i.uncompress=ue;break;case"DWAB_COMPRESSION":i.lines=256,i.uncompress=ue;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(i.scanlineBlockSize=i.lines,1==i.type)switch(a){case THREE.FloatType:i.getter=Ae,i.inputSize=y;break;case THREE.HalfFloatType:i.getter=me,i.inputSize=y;break}else{if(2!=i.type)throw"EXRLoader.parse: unsupported pixelType "+i.type+" for "+e.compression+".";switch(a){case THREE.FloatType:i.getter=Se,i.inputSize=p;break;case THREE.HalfFloatType:i.getter=be,i.inputSize=p}}i.blockCount=(e.dataWindow.yMax+1)/i.scanlineBlockSize;for(var o=0;o<i.blockCount;o++)Ee(r,t);i.outputChannels=3==i.channels?4:i.channels;const l=i.width*i.height*i.outputChannels;switch(a){case THREE.FloatType:i.byteArray=new Float32Array(l),i.channels<i.outputChannels&&i.byteArray.fill(1,0,l);break;case THREE.HalfFloatType:i.byteArray=new Uint16Array(l),i.channels<i.outputChannels&&i.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",a);break}return i.bytesPerLine=i.width*i.inputSize*i.channels,4==i.outputChannels?(i.format=THREE.RGBAFormat,i.encoding=THREE.LinearEncoding):(i.format=THREE.RedFormat,i.encoding=THREE.LinearEncoding),i}const Pe=new DataView(e),He=new Uint8Array(e),Ne={value:0},Le=Ie(Pe,e,Ne),De=xe(Le,Pe,He,Ne,this.type),_e={value:0},Fe={R:0,G:1,B:2,A:3,Y:0};for(let Xe=0;Xe<De.height/De.scanlineBlockSize;Xe++){const e=pe(Pe,Ne);De.size=pe(Pe,Ne),De.lines=e+De.scanlineBlockSize>De.height?De.height-e:De.scanlineBlockSize;const r=De.size<De.lines*De.bytesPerLine,n=r?De.uncompress(De):ae(De);Ne.value+=De.size;for(let t=0;t<De.scanlineBlockSize;t++){const e=t+Xe*De.scanlineBlockSize;if(e>=De.height)break;for(let r=0;r<De.channels;r++){const a=Fe[Le.channels[r].name];for(let i=0;i<De.width;i++){_e.value=(t*(De.channels*De.width)+r*De.width+i)*De.inputSize;const o=(De.height-1-e)*(De.width*De.outputChannels)+i*De.outputChannels+a;De.byteArray[o]=De.getter(n,_e)}}}}return{header:Le,width:De.width,height:De.height,data:De.byteArray,format:De.format,encoding:De.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,r,n,t){function a(e,n){e.encoding=n.encoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,r&&r(e,n)}return super.load(e,a,n,t)}}THREE.EXRLoader=e})();