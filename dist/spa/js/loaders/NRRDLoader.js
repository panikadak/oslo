(function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,r,t,n){const s=this,a=new THREE.FileLoader(s.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,(function(t){try{r(s.parse(t))}catch(a){n?n(a):console.error(a),s.manager.itemError(e)}}),t,n)}parse(e){let t=e,n=0;const s=new Int8Array(new Int16Array([1]).buffer)[0]>0,a=!0,i={};function o(e,r){void 0!==r&&null!==r||(r=1);let i=1,o=Uint8Array;switch(e){case"uchar":break;case"schar":o=Int8Array;break;case"ushort":o=Uint16Array,i=2;break;case"sshort":o=Int16Array,i=2;break;case"uint":o=Uint32Array,i=4;break;case"sint":o=Int32Array,i=4;break;case"float":o=Float32Array,i=4;break;case"complex":o=Float64Array,i=8;break;case"double":o=Float64Array,i=8;break}let h=new o(t.slice(n,n+=r*i));return s!=a&&(h=c(h,i)),1==r?h[0]:h}function c(e,r){const t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(let n=0;n<e.byteLength;n+=r)for(let e=n+r-1,s=n;e>s;e--,s++){const r=t[s];t[s]=t[e],t[e]=r}return e}function h(e){let t,n,s,a,o,c,h,l;const u=e.split(/\r?\n/);for(h=0,l=u.length;h<l;h++)o=u[h],o.match(/NRRD\d+/)?i.isNrrd=!0:o.match(/^#/)||(c=o.match(/(.*):(.*)/))&&(n=c[1].trim(),t=c[2].trim(),s=r[n],s?s.call(i,t):i[n]=t);if(!i.isNrrd)throw new Error("Not an NRRD file");if("bz2"===i.encoding||"bzip2"===i.encoding)throw new Error("Bzip is not supported");if(!i.vectors&&(i.vectors=[],i.vectors.push([1,0,0]),i.vectors.push([0,1,0]),i.vectors.push([0,0,1]),i.spacings))for(a=0;a<=2;a++)if(!isNaN(i.spacings[a]))for(let e=0;e<=2;e++)i.vectors[a][e]*=i.spacings[a]}function l(e,r,t){let n,s="";r=r||0,t=t||e.length;const a=i.sizes.reduce((function(e,r){return e*r}),1);let o=10;"hex"===i.encoding&&(o=16);const c=new i.__array(a);let h=0,l=parseInt;i.__array!==Float32Array&&i.__array!==Float64Array||(l=parseFloat);for(let i=r;i<t;i++)n=e[i],(n<9||n>13)&&32!==n?s+=String.fromCharCode(n):(""!==s&&(c[h]=l(s,o),h++),s="");return""!==s&&(c[h]=l(s,o),h++),c}const u=o("uchar",e.byteLength),d=u.length;let f,p=null,y=0;for(f=1;f<d;f++)if(10==u[f-1]&&10==u[f]){p=this.parseChars(u,0,f-2),y=f+1;break}if(h(p),t=u.subarray(y),"gz"===i.encoding.substring(0,2))t=fflate.gunzipSync(new Uint8Array(t));else if("ascii"===i.encoding||"text"===i.encoding||"txt"===i.encoding||"hex"===i.encoding)t=l(t);else if("raw"===i.encoding){const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];t=e}t=t.buffer;const g=new THREE.Volume;g.header=i,g.data=new i.__array(t);const w=g.computeMinMax(),b=w[0],m=w[1];if(g.windowLow=b,g.windowHigh=m,g.dimensions=[i.sizes[0],i.sizes[1],i.sizes[2]],g.xLength=g.dimensions[0],g.yLength=g.dimensions[1],g.zLength=g.dimensions[2],i.vectors){const e=i.vectors.findIndex((e=>0!==e[0])),r=i.vectors.findIndex((e=>0!==e[1])),t=i.vectors.findIndex((e=>0!==e[2])),n=[];n[e]="x",n[r]="y",n[t]="z",g.axisOrder=n}else g.axisOrder=["x","y","z"];const _=(new THREE.Vector3).fromArray(i.vectors[0]).length(),E=(new THREE.Vector3).fromArray(i.vectors[1]).length(),x=(new THREE.Vector3).fromArray(i.vectors[2]).length();g.spacing=[_,E,x],g.matrix=new THREE.Matrix4;const A=new THREE.Matrix4;if("left-posterior-superior"===i.space?A.set(-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1):"left-anterior-superior"===i.space&&A.set(1,0,0,0,0,1,0,0,0,0,-1,0,0,0,0,1),i.vectors){const e=i.vectors,r=(new THREE.Matrix4).set(e[0][0],e[1][0],e[2][0],0,e[0][1],e[1][1],e[2][1],0,e[0][2],e[1][2],e[2][2],0,0,0,0,1),t=(new THREE.Matrix4).multiplyMatrices(r,A);g.matrix=t}else g.matrix.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return g.inverseMatrix=new THREE.Matrix4,g.inverseMatrix.copy(g.matrix).invert(),g.RASDimensions=new THREE.Vector3(g.xLength,g.yLength,g.zLength).applyMatrix4(g.matrix).round().toArray().map(Math.abs),g.lowerThreshold===-1/0&&(g.lowerThreshold=b),g.upperThreshold===1/0&&(g.upperThreshold=m),g}parseChars(e,r,t){void 0===r&&(r=0),void 0===t&&(t=e.length);let n="",s=0;for(s=r;s<t;++s)n+=String.fromCharCode(e[s]);return n}}const r={type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){let r;return this.sizes=function(){const t=e.split(/\s+/),n=[];for(let e=0,s=t.length;e<s;e++)r=t[e],n.push(parseInt(r,10));return n}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){let r,t;const n=e.match(/\(.*?\)/g);return this.vectors=function(){const e=[];for(let s=0,a=n.length;s<a;s++)t=n[s],e.push(function(){const e=t.slice(1,-1).split(/,/),n=[];for(let t=0,s=e.length;t<s;t++)r=e[t],n.push(parseFloat(r));return n}());return e}()},spacings:function(e){let r;const t=e.split(/\s+/);return this.spacings=function(){const e=[];for(let n=0,s=t.length;n<s;n++)r=t[n],e.push(parseFloat(r));return e}()}};THREE.NRRDLoader=e})();