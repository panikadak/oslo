(function(){function t(t,e,i,n,a){if(arguments.length>0){switch(this.xLength=Number(t)||1,this.yLength=Number(e)||1,this.zLength=Number(i)||1,this.axisOrder=["x","y","z"],n){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(a);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(a);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(a);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(a);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(a);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(a);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(a);break;case"Float64":case"float64":case"double":this.data=new Float64Array(a);break;default:this.data=new Uint8Array(a)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new THREE.Matrix3,this.matrix.identity();var s=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return s},set:function(t){s=t,this.sliceList.forEach((function(t){t.geometryNeedsUpdate=!0}))}});var r=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return r},set:function(t){r=t,this.sliceList.forEach((function(t){t.geometryNeedsUpdate=!0}))}}),this.sliceList=[]}t.prototype={constructor:t,getData:function(t,e,i){return this.data[i*this.xLength*this.yLength+e*this.xLength+t]},access:function(t,e,i){return i*this.xLength*this.yLength+e*this.xLength+t},reverseAccess:function(t){var e=Math.floor(t/(this.yLength*this.xLength)),i=Math.floor((t-e*this.yLength*this.xLength)/this.xLength),n=t-e*this.yLength*this.xLength-i*this.xLength;return[n,i,e]},map:function(t,e){var i=this.data.length;e=e||this;for(var n=0;n<i;n++)this.data[n]=t.call(e,this.data[n],n,this.data);return this},extractPerpendicularPlane:function(t,e){var i,n,a,s,r,h,c,o,g,u=(new THREE.Matrix4).identity(),d=this,l=new THREE.Vector3,f=new THREE.Vector3,x=new THREE.Vector3,E=new THREE.Vector3(this.xLength,this.yLength,this.zLength);switch(t){case"x":l.set(1,0,0),f.set(0,0,-1),x.set(0,-1,0),h=this.spacing[this.axisOrder.indexOf("z")],c=this.spacing[this.axisOrder.indexOf("y")],g=new THREE.Vector3(e,0,0),u.multiply((new THREE.Matrix4).makeRotationY(Math.PI/2)),o=(d.RASDimensions[0]-1)/2,u.setPosition(new THREE.Vector3(e-o,0,0));break;case"y":l.set(0,1,0),f.set(1,0,0),x.set(0,0,1),h=this.spacing[this.axisOrder.indexOf("x")],c=this.spacing[this.axisOrder.indexOf("z")],g=new THREE.Vector3(0,e,0),u.multiply((new THREE.Matrix4).makeRotationX(-Math.PI/2)),o=(d.RASDimensions[1]-1)/2,u.setPosition(new THREE.Vector3(0,e-o,0));break;case"z":default:l.set(0,0,1),f.set(1,0,0),x.set(0,-1,0),h=this.spacing[this.axisOrder.indexOf("x")],c=this.spacing[this.axisOrder.indexOf("y")],g=new THREE.Vector3(0,0,e),o=(d.RASDimensions[2]-1)/2,u.setPosition(new THREE.Vector3(0,0,e-o));break}f.applyMatrix4(d.inverseMatrix).normalize(),f.argVar="i",x.applyMatrix4(d.inverseMatrix).normalize(),x.argVar="j",l.applyMatrix4(d.inverseMatrix).normalize(),i=Math.floor(Math.abs(f.dot(E))),n=Math.floor(Math.abs(x.dot(E))),s=Math.abs(i*h),r=Math.abs(n*c),g=Math.abs(Math.round(g.applyMatrix4(d.inverseMatrix).dot(l)));var p=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],y=[f,x,l].find((function(t){return Math.abs(t.dot(p[0]))>.9})),L=[f,x,l].find((function(t){return Math.abs(t.dot(p[1]))>.9})),w=[f,x,l].find((function(t){return Math.abs(t.dot(p[2]))>.9}));return a=function(t,e){var i=y===l?g:"i"===y.argVar?t:e,n=L===l?g:"i"===L.argVar?t:e,a=w===l?g:"i"===w.argVar?t:e,s=y.dot(p[0])>0?i:d.xLength-1-i,r=L.dot(p[1])>0?n:d.yLength-1-n,h=w.dot(p[2])>0?a:d.zLength-1-a;return d.access(s,r,h)},{iLength:i,jLength:n,sliceAccess:a,matrix:u,planeWidth:s,planeHeight:r}},extractSlice:function(t,e){var i=new THREE.VolumeSlice(this,e,t);return this.sliceList.push(i),i},repaintAllSlices:function(){return this.sliceList.forEach((function(t){t.repaint()})),this},computeMinMax:function(){var t=1/0,e=-1/0,i=this.data.length,n=0;for(n=0;n<i;n++)if(!isNaN(this.data[n])){var a=this.data[n];t=Math.min(t,a),e=Math.max(e,a)}return this.min=t,this.max=e,[t,e]}},THREE.Volume=t})();