(function(){class e{constructor(e,t,r){this.variables=[],this.currentTextureIndex=0;let n=THREE.FloatType;const a=new THREE.Scene,i=new THREE.Camera;i.position.z=1;const s={passThruTexture:{value:null}},u=d(c(),s),l=new THREE.Mesh(new THREE.PlaneGeometry(2,2),u);function o(r){r.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function d(e,t){t=t||{};const r=new THREE.ShaderMaterial({uniforms:t,vertexShader:T(),fragmentShader:e});return o(r),r}function T(){return"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n"}function c(){return"uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n"}a.add(l),this.setDataType=function(e){return n=e,this},this.addVariable=function(e,t,r){const n=this.createShaderMaterial(t),a={name:e,initialValueTexture:r,material:n,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};return this.variables.push(a),a},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!1===r.capabilities.isWebGL2&&!1===r.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===r.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let r=0;r<this.variables.length;r++){const n=this.variables[r];n.renderTargets[0]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),n.renderTargets[1]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),this.renderTexture(n.initialValueTexture,n.renderTargets[0]),this.renderTexture(n.initialValueTexture,n.renderTargets[1]);const a=n.material,i=a.uniforms;if(null!==n.dependencies)for(let e=0;e<n.dependencies.length;e++){const t=n.dependencies[e];if(t.name!==n.name){let e=!1;for(let r=0;r<this.variables.length;r++)if(t.name===this.variables[r].name){e=!0;break}if(!e)return"Variable dependency not found. Variable="+n.name+", dependency="+t.name}i[t.name]={value:null},a.fragmentShader="\nuniform sampler2D "+t.name+";\n"+a.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){const e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0;for(let r=0,n=this.variables.length;r<n;r++){const n=this.variables[r];if(null!==n.dependencies){const t=n.material.uniforms;for(let r=0,a=n.dependencies.length;r<a;r++){const a=n.dependencies[r];t[a.name].value=a.renderTargets[e].texture}}this.doRenderTarget(n.material,n.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=o,this.createShaderMaterial=d,this.createRenderTarget=function(r,a,i,s,u,l){r=r||e,a=a||t,i=i||THREE.ClampToEdgeWrapping,s=s||THREE.ClampToEdgeWrapping,u=u||THREE.NearestFilter,l=l||THREE.NearestFilter;const o=new THREE.WebGLRenderTarget(r,a,{wrapS:i,wrapT:s,minFilter:u,magFilter:l,format:THREE.RGBAFormat,type:n,depthBuffer:!1});return o},this.createTexture=function(){const r=new Float32Array(e*t*4),n=new THREE.DataTexture(r,e,t,THREE.RGBAFormat,THREE.FloatType);return n.needsUpdate=!0,n},this.renderTexture=function(e,t){s.passThruTexture.value=e,this.doRenderTarget(u,t),s.passThruTexture.value=null},this.doRenderTarget=function(e,t){const n=r.getRenderTarget();l.material=e,r.setRenderTarget(t),r.render(a,i),l.material=u,r.setRenderTarget(n)}}}THREE.GPUComputationRenderer=e})();