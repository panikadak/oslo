(function(){class e extends THREE.DataTextureLoader{constructor(e){super(e),this.type=THREE.HalfFloatType}parse(e){const t=-1,r=1,a=2,n=3,i=4,o=function(e,o){switch(e){case r:console.error("THREE.RGBELoader Read Error: "+(o||""));break;case a:console.error("THREE.RGBELoader Write Error: "+(o||""));break;case n:console.error("THREE.RGBELoader Bad File Format: "+(o||""));break;default:case i:console.error("THREE.RGBELoader: Error: "+(o||""))}return t},s=1,l=2,E=4,c="\n",p=function(e,t,r){const a=128;t=t||1024;let n=e.pos,i=-1,o=0,s="",l=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+a)));while(0>(i=l.indexOf(c))&&o<t&&n<e.byteLength)s+=l,o+=l.length,n+=a,l+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+a)));return-1<i&&(!1!==r&&(e.pos+=o+i+1),s+l.slice(0,i))},f=function(e){const t=/^#\?(\S+)/,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,c=/^\s*FORMAT=(\S+)\s*$/,f=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,d={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let h,u;if(e.pos>=e.byteLength||!(h=p(e)))return o(r,"no header found");if(!(u=h.match(t)))return o(n,"bad initial token");d.valid|=s,d.programtype=u[1],d.string+=h+"\n";while(1){if(h=p(e),!1===h)break;if(d.string+=h+"\n","#"!==h.charAt(0)){if((u=h.match(a))&&(d.gamma=parseFloat(u[1],10)),(u=h.match(i))&&(d.exposure=parseFloat(u[1],10)),(u=h.match(c))&&(d.valid|=l,d.format=u[1]),(u=h.match(f))&&(d.valid|=E,d.height=parseInt(u[1],10),d.width=parseInt(u[2],10)),d.valid&l&&d.valid&E)break}else d.comments+=h+"\n"}return d.valid&l?d.valid&E?d:o(n,"missing image size specifier"):o(n,"missing format specifier")},d=function(e,t,a){const s=t;if(s<8||s>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(s!==(e[2]<<8|e[3]))return o(n,"wrong scanline width");const l=new Uint8Array(4*t*a);if(!l.length)return o(i,"unable to allocate buffer space");let E=0,c=0;const p=4*s,f=new Uint8Array(4),d=new Uint8Array(p);let h=a;while(h>0&&c<e.byteLength){if(c+4>e.byteLength)return o(r);if(f[0]=e[c++],f[1]=e[c++],f[2]=e[c++],f[3]=e[c++],2!=f[0]||2!=f[1]||(f[2]<<8|f[3])!=s)return o(n,"bad rgbe scanline format");let t,a=0;while(a<p&&c<e.byteLength){t=e[c++];const r=t>128;if(r&&(t-=128),0===t||a+t>p)return o(n,"bad scanline data");if(r){const r=e[c++];for(let e=0;e<t;e++)d[a++]=r}else d.set(e.subarray(c,c+t),a),a+=t,c+=t}const i=s;for(let e=0;e<i;e++){let t=0;l[E]=d[e+t],t+=s,l[E+1]=d[e+t],t+=s,l[E+2]=d[e+t],t+=s,l[E+3]=d[e+t],E+=4}h--}return l},h=function(e,t,r,a){const n=e[t+3],i=Math.pow(2,n-128)/255;r[a+0]=e[t+0]*i,r[a+1]=e[t+1]*i,r[a+2]=e[t+2]*i},u=function(e,t,r,a){const n=e[t+3],i=Math.pow(2,n-128)/255;r[a+0]=THREE.DataUtils.toHalfFloat(Math.min(e[t+0]*i,65504)),r[a+1]=THREE.DataUtils.toHalfFloat(Math.min(e[t+1]*i,65504)),r[a+2]=THREE.DataUtils.toHalfFloat(Math.min(e[t+2]*i,65504))},m=new Uint8Array(e);m.pos=0;const g=f(m);if(t!==g){const e=g.width,r=g.height,a=d(m.subarray(m.pos),e,r);if(t!==a){let t,n,i,o;switch(this.type){case THREE.FloatType:o=a.length/4;const e=new Float32Array(3*o);for(let t=0;t<o;t++)h(a,4*t,e,3*t);t=e,n=THREE.RGBFormat,i=THREE.FloatType;break;case THREE.HalfFloatType:o=a.length/4;const r=new Uint16Array(3*o);for(let t=0;t<o;t++)u(a,4*t,r,3*t);t=r,n=THREE.RGBFormat,i=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:e,height:r,data:t,header:g.string,gamma:g.gamma,exposure:g.exposure,format:n,type:i}}}return null}setDataType(e){return this.type=e,this}load(e,t,r,a){function n(e,r){switch(e.type){case THREE.FloatType:e.encoding=THREE.LinearEncoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.flipY=!0;break;case THREE.HalfFloatType:e.encoding=THREE.LinearEncoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.flipY=!0;break}t&&t(e,r)}return super.load(e,n,r,a)}}THREE.RGBELoader=e})();