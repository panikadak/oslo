(function(){class t extends THREE.DataTextureLoader{constructor(t){super(t),this.type=THREE.HalfFloatType}parse(t){const e=r.decode(t);r.decodeImage(t,e[0]);const n=r.toRGBA(e[0],this.type);return{width:e[0].width,height:e[0].height,data:n,format:THREE.RGBAFormat,type:this.type,flipY:!0}}setDataType(t){return this.type=t,this}}const r={decode:function(t,e){null==e&&(e={parseMN:!0,debug:!1});var n=new Uint8Array(t),i=0,a=r._binBE.readASCII(n,i,2);i+=2;var o="II"==a?r._binLE:r._binBE;o.readUshort(n,i),i+=2;var f=o.readUint(n,i);i+=4;var u=[];while(1){var l=o.readUshort(n,f),h=o.readUshort(n,f+4);if(0!=l&&(h<1||13<h)){console.log("error in TIFF");break}if(r._readIFD(o,n,f,u,0,e),f=o.readUint(n,f+2+12*l),0==f)break}return u},decodeImage:function(t,e,n){if(!e.data){var i=new Uint8Array(t),a=r._binBE.readASCII(i,0,2);if(null!=e["t256"]){e.isLE="II"==a,e.width=e["t256"][0],e.height=e["t257"][0];var o,f=e["t259"]?e["t259"][0]:1,u=e["t266"]?e["t266"][0]:1;e["t284"]&&2==e["t284"][0]&&console.log("PlanarConfiguration 2 should not be used!"),7==f&&e["t258"]&&e["t258"].length>3&&(e["t258"]=e["t258"].slice(0,3)),o=e["t258"]?Math.min(32,e["t258"][0])*e["t258"].length:e["t277"]?e["t277"][0]:1,1==f&&null!=e["t279"]&&e["t278"]&&32803==e["t262"][0]&&(o=Math.round(8*e["t279"][0]/(e.width*e["t278"][0])));var l=8*Math.ceil(e.width*o/8),h=e["t273"];null==h&&(h=e["t324"]);var d=e["t279"];1==f&&1==h.length&&(d=[e.height*(l>>>3)]),null==d&&(d=e["t325"]);var s=new Uint8Array(e.height*(l>>>3)),c=0;if(null!=e["t322"]){for(var E=e["t322"][0],b=e["t323"][0],v=Math.floor((e.width+E-1)/E),_=Math.floor((e.height+b-1)/b),g=new Uint8Array(0|Math.ceil(E*b*o/8)),B=0;B<_;B++)for(var p=0;p<v;p++){for(var w=B*v+p,I=0;I<g.length;I++)g[I]=0;r.decode._decompress(e,n,i,h[w],d[w],f,g,0,u),6==f?s=g:r._copyTile(g,0|Math.ceil(E*o/8),b,s,0|Math.ceil(e.width*o/8),e.height,0|Math.ceil(p*E*o/8),B*b)}c=8*s.length}else{var U=e["t278"]?e["t278"][0]:e.height;U=Math.min(U,e.height);for(w=0;w<h.length;w++)r.decode._decompress(e,n,i,h[w],d[w],f,s,0|Math.ceil(c/8),u),c+=l*U;c=Math.min(c,8*s.length)}e.data=new Uint8Array(s.buffer,0,0|Math.ceil(c/8))}}}};r.decode._decompress=function(t,e,n,i,a,o,f,u){34676==o?r.decode._decodeLogLuv32(t,n,i,a,f,u):console.log("Unsupported compression",o);var l=t["t258"]?Math.min(32,t["t258"][0]):1,h=t["t277"]?t["t277"][0]:1,d=l*h>>>3,s=t["t278"]?t["t278"][0]:t.height,c=Math.ceil(l*h*t.width/8);if(16==l&&!t.isLE&&null==t["t33422"])for(var E=0;E<s;E++)for(var b=u+E*c,v=1;v<c;v+=2){var _=f[b+v];f[b+v]=f[b+v-1],f[b+v-1]=_}if(t["t317"]&&2==t["t317"][0])for(E=0;E<s;E++){var g=u+E*c;if(16==l)for(var B=d;B<c;B+=2){var p=(f[g+B+1]<<8|f[g+B])+(f[g+B-d+1]<<8|f[g+B-d]);f[g+B]=255&p,f[g+B+1]=p>>>8&255}else if(3==h)for(B=3;B<c;B+=3)f[g+B]=f[g+B]+f[g+B-3]&255,f[g+B+1]=f[g+B+1]+f[g+B-2]&255,f[g+B+2]=f[g+B+2]+f[g+B-1]&255;else for(B=d;B<c;B++)f[g+B]=f[g+B]+f[g+B-d]&255}},r.decode._decodeLogLuv32=function(t,r,e,n,i,a){var o=t.width,f=4*o,u=0,l=new Uint8Array(f);while(u<n){var h=0;while(h<f){var d=r[e+u];if(u++,d<128){for(var s=0;s<d;s++)l[h+s]=r[e+u+s];h+=d,u+=d}else{d-=126;for(s=0;s<d;s++)l[h+s]=r[e+u];h+=d,u++}}for(var c=0;c<o;c++)i[a+0]=l[c],i[a+1]=l[c+o],i[a+2]=l[c+2*o],i[a+4]=l[c+3*o],a+=6}},r.tags={},r._types=function(){var t=new Array(250);t.fill(0),t=t.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);var r={33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7};return{basic:{main:t,rest:r},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}}(),r._readIFD=function(t,e,n,i,a,o){var f=t.readUshort(e,n);n+=2;var u={};o.debug&&console.log("   ".repeat(a),i.length-1,">>>----------------");for(var l=0;l<f;l++){var h=t.readUshort(e,n);n+=2;var d=t.readUshort(e,n);n+=2;var s=t.readUint(e,n);n+=4;var c=t.readUint(e,n);n+=4;var E=[];if(1!=d&&7!=d||(E=new Uint8Array(e.buffer,s<5?n-4:c,s)),2==d){var b=s<5?n-4:c,v=e[b],_=Math.max(0,Math.min(s-1,e.length-b));v<128||0==_?E.push(t.readASCII(e,b,_)):E=new Uint8Array(e.buffer,b,_)}if(3==d)for(var g=0;g<s;g++)E.push(t.readUshort(e,(s<3?n-4:c)+2*g));if(4==d||13==d)for(g=0;g<s;g++)E.push(t.readUint(e,(s<2?n-4:c)+4*g));if(5==d||10==d){var B=5==d?t.readUint:t.readInt;for(g=0;g<s;g++)E.push([B(e,c+8*g),B(e,c+8*g+4)])}if(8==d)for(g=0;g<s;g++)E.push(t.readShort(e,(s<3?n-4:c)+2*g));if(9==d)for(g=0;g<s;g++)E.push(t.readInt(e,(s<2?n-4:c)+4*g));if(11==d)for(g=0;g<s;g++)E.push(t.readFloat(e,c+4*g));if(12==d)for(g=0;g<s;g++)E.push(t.readDouble(e,c+8*g));if(0==s||0!=E.length){if(o.debug&&console.log("   ".repeat(a),h,d,r.tags[h],E),u["t"+h]=E,330==h&&u["t272"]&&"DSLR-A100"==u["t272"][0]);else if(330==h||34665==h||34853==h||50740==h&&t.readUshort(e,t.readUint(E,0))<300||61440==h){var p=50740==h?[t.readUint(E,0)]:E,w=[];for(g=0;g<p.length;g++)r._readIFD(t,e,p[g],w,a+1,o);330==h&&(u.subIFD=w),34665==h&&(u.exifIFD=w[0]),34853==h&&(u.gpsiIFD=w[0]),50740==h&&(u.dngPrvt=w[0]),61440==h&&(u.fujiIFD=w[0])}if(37500==h&&o.parseMN){var I=E;if("Nikon"==t.readASCII(I,0,5))u.makerNote=r["decode"](I.slice(10).buffer)[0];else if(t.readUshort(e,c)<300&&t.readUshort(e,c+4)<=12){var U=[];r._readIFD(t,e,c,U,a+1,o),u.makerNote=U[0]}}}else if(console.log(h,"unknown TIFF tag type: ",d,"num:",s),0==l)return}return i.push(u),o.debug&&console.log("   ".repeat(a),"<<<---------------"),n},r.toRGBA=function(t,r){const e=t.width,n=t.height,i=e*n,a=t.data;let o;switch(r){case THREE.HalfFloatType:o=new Uint16Array(4*i);break;case THREE.FloatType:o=new Float32Array(4*i);break;default:console.error("THREE.LogLuvLoader: Unsupported texture data type:",r)}let f=t["t262"]?t["t262"][0]:2;const u=t["t258"]?Math.min(32,t["t258"][0]):1;if(null==t["t262"]&&1==u&&(f=0),32845==f)for(let l=0;l<n;l++)for(let t=0;t<e;t++){const n=6*(l*e+t),i=4*(l*e+t);let f=a[n+1]<<8|a[n];f=Math.pow(2,(f+.5)/256-64);const u=(a[n+3]+.5)/410,h=(a[n+5]+.5)/410,d=9*u/(6*u-16*h+12),s=4*h/(6*u-16*h+12),c=f,E=d*c/s,b=c,v=(1-d-s)*c/s,_=2.69*E-1.276*b-.414*v,g=-1.022*E+1.978*b+.044*v,B=.061*E-.224*b+1.163*v;r===THREE.HalfFloatType?(o[i]=THREE.DataUtils.toHalfFloat(Math.min(_,65504)),o[i+1]=THREE.DataUtils.toHalfFloat(Math.min(g,65504)),o[i+2]=THREE.DataUtils.toHalfFloat(Math.min(B,65504)),o[i+3]=THREE.DataUtils.toHalfFloat(1)):(o[i]=_,o[i+1]=g,o[i+2]=B,o[i+3]=1)}else console.log("Unsupported Photometric interpretation: "+f);return o},r._binBE={nextZero:function(t,r){while(0!=t[r])r++;return r},readUshort:function(t,r){return t[r]<<8|t[r+1]},readShort:function(t,e){var n=r._binBE.ui8;return n[0]=t[e+1],n[1]=t[e+0],r._binBE.i16[0]},readInt:function(t,e){var n=r._binBE.ui8;return n[0]=t[e+3],n[1]=t[e+2],n[2]=t[e+1],n[3]=t[e+0],r._binBE.i32[0]},readUint:function(t,e){var n=r._binBE.ui8;return n[0]=t[e+3],n[1]=t[e+2],n[2]=t[e+1],n[3]=t[e+0],r._binBE.ui32[0]},readASCII:function(t,r,e){for(var n="",i=0;i<e;i++)n+=String.fromCharCode(t[r+i]);return n},readFloat:function(t,e){for(var n=r._binBE.ui8,i=0;i<4;i++)n[i]=t[e+3-i];return r._binBE.fl32[0]},readDouble:function(t,e){for(var n=r._binBE.ui8,i=0;i<8;i++)n[i]=t[e+7-i];return r._binBE.fl64[0]},writeUshort:function(t,r,e){t[r]=e>>8&255,t[r+1]=255&e},writeInt:function(t,e,n){var i=r._binBE.ui8;r._binBE.i32[0]=n,t[e+3]=i[0],t[e+2]=i[1],t[e+1]=i[2],t[e+0]=i[3]},writeUint:function(t,r,e){t[r]=e>>24&255,t[r+1]=e>>16&255,t[r+2]=e>>8&255,t[r+3]=e>>0&255},writeASCII:function(t,r,e){for(var n=0;n<e.length;n++)t[r+n]=e.charCodeAt(n)},writeDouble:function(t,e,n){r._binBE.fl64[0]=n;for(var i=0;i<8;i++)t[e+i]=r._binBE.ui8[7-i]}},r._binBE.ui8=new Uint8Array(8),r._binBE.i16=new Int16Array(r._binBE.ui8.buffer),r._binBE.i32=new Int32Array(r._binBE.ui8.buffer),r._binBE.ui32=new Uint32Array(r._binBE.ui8.buffer),r._binBE.fl32=new Float32Array(r._binBE.ui8.buffer),r._binBE.fl64=new Float64Array(r._binBE.ui8.buffer),r._binLE={nextZero:r._binBE.nextZero,readUshort:function(t,r){return t[r+1]<<8|t[r]},readShort:function(t,e){var n=r._binBE.ui8;return n[0]=t[e+0],n[1]=t[e+1],r._binBE.i16[0]},readInt:function(t,e){var n=r._binBE.ui8;return n[0]=t[e+0],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],r._binBE.i32[0]},readUint:function(t,e){var n=r._binBE.ui8;return n[0]=t[e+0],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],r._binBE.ui32[0]},readASCII:r._binBE.readASCII,readFloat:function(t,e){for(var n=r._binBE.ui8,i=0;i<4;i++)n[i]=t[e+i];return r._binBE.fl32[0]},readDouble:function(t,e){for(var n=r._binBE.ui8,i=0;i<8;i++)n[i]=t[e+i];return r._binBE.fl64[0]},writeUshort:function(t,r,e){t[r]=255&e,t[r+1]=e>>8&255},writeInt:function(t,e,n){var i=r._binBE.ui8;r._binBE.i32[0]=n,t[e+0]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3]},writeUint:function(t,r,e){t[r]=e>>>0&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24&255},writeASCII:r._binBE.writeASCII},r._copyTile=function(t,r,e,n,i,a,o,f){for(var u=Math.min(r,i-o),l=Math.min(e,a-f),h=0;h<l;h++)for(var d=(f+h)*i+o,s=h*r,c=0;c<u;c++)n[d+c]=t[s+c]},THREE.LogLuvLoader=t})();